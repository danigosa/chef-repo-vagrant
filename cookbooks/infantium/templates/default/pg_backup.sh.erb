#!/bin/sh
##############################
#Script by danigosa
##############################

#Substitute your postgresql root username in the below given line
PGUSER=postgres
#Substitute your postgresql root password in the below given line
#PGPASSWORD=mypostgre
PGPASSWORD=postgres
export PGUSER PGPASSWORD

tdate=`date +%d-%b-%Y`
spath=/var/backups/database/postgresql
dbname=infantiumdb

if [ -d $spath/pg_backup_$dbname ]
#if folder name pg_backup_'databsename' exist in the current users home directory
then
    #override/create file
    pg_dump $dbname -f $spath/pg_backup_$dbname/$dbname_$tdate -i -x -O -R
else
    #if folder pg_backup_'databsename' does not exist in the current users home dierectory then
    #Create a new folder
    mkdir $spath/pg_backup_$dbname
    #then create dump and save it
    pg_dump $dbname -f $spath/pg_backup_$dbname/$dbname_$tdate -i -x -O -R
    #if databse to take does not exist then Delete the folder created
    if [ $? -ne 0 ]
    then
        rmdir $spath/pg_backup_$dbname
    fi
fi

#reset PGUSER and PGPASSWORD
PGUSER=""
PGPASSWORD=""
export PGUSER PGPASSWORD
#End
